<!DOCTYPE html>
<html>
  <head>
    <script>
      var scribblingCanvas;
      var drawingContext;
      var lastPoint;
      var shouldTrackTouch;
      var dataURL;
      function init()
      {
        scribblingCanvas = document.getElementById('scribbleCanvas');
        drawingContext = scribblingCanvas.getContext("2d");
        scribblingCanvas.addEventListener("mousedown",touchBegan);
        scribblingCanvas.addEventListener("mousemove",touchesMoved);
        scribblingCanvas.addEventListener("touchdown",touchBegan);
        scribblingCanvas.addEventListener("touchmove",touchesMoved);
        scribblingCanvas.addEventListener("touchend",touchEnded);
         
        document.body.addEventListener("mouseup",touchEnded);
        document.body.addEventListener("touchcancel",touchEnded);
      
      }
      function getCoordinatesFromEvent(e) {
        var x;
        var y;
    	if (e.x != undefined && e.y != undefined)
        {
          x = e.x;
          y = e.y;
        }
        else // For firefox
        {
          x = e.clientX + document.body.scrollLeft +
              document.documentElement.scrollLeft;
          y = e.clientY + document.body.scrollTop +
              document.documentElement.scrollTop;
        }

        x -= scribblingCanvas.offsetLeft;
        y -= scribblingCanvas.offsetTop;
        var Point = {'x':x,'y':y};
        return Point;
      }

      function touchBegan(e) {
        console.log("touchBegan");
        Point =getCoordinatesFromEvent(e);
        scribblingCanvas.fillStyle="#FF0000";
        drawingContext.fillRect(Point.x,Point.y,1,1);
        shouldTrackTouch = true; 
        lastPoint = Point;
        
      }
      
      function touchesMoved(e) {
        if(shouldTrackTouch==true) {
            
            touchedPoint=getCoordinatesFromEvent(e);
            drawingContext.beginPath();
            drawingContext.moveTo(lastPoint.x,lastPoint.y);
            drawingContext.lineTo(touchedPoint.x,touchedPoint.y);
            drawingContext.stroke();
            lastPoint=touchedPoint;
            
        }
      }
      function touchEnded(e) {
             if(shouldTrackTouch==true) {
               console.log('touchEnded');
               dataURL=scribblingCanvas.toDataURL();
               shouldTrackTouch = false;
            }
      }
      function clearCanvas() {
         drawingContext.clearRect(0,0,scribblingCanvas.width,scribblingCanvas.height);
      
      }
     
      

    </script>
  </head>
  <body onload="init()">
    <canvas id="scribbleCanvas" width="800" height="600" style="border:1pt solid black">
    </canvas>
    <br/>
    <input type="button" value="clear" onclick="clearCanvas()"/>
    <input type="button" value="redraw" onclick="redrawImg()"/>
  </body>
</html>
